# MBRè‡ªåŠ¨åŒ–ç³»ç»Ÿ - å½“å‰çŠ¶æ€æ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒæ•°æ®å¤„ç†å¼•æ“ (Phase 1)

#### æ•°æ®æ¨¡å‹å±‚
- âœ… [data_schema.py](src/models/data_schema.py) - å®Œæ•´çš„æ•°æ®æ¨¡å‹å®šä¹‰
  - TargetMetric: æ—¥åº¦KPIæ•°æ®
  - MonthlyMetrics: æœˆåº¦èšåˆæ•°æ®
  - æ–°å¢FF(å‘˜å·¥ç¦åˆ©)å­—æ®µæ”¯æŒ
  - æ–°å¢æ´¾ç”Ÿæ¸ é“ç±»å‹ (DTC_EXCL_FF, DTC_EXCL_FF_SC, CORE_BUSINESS)
  - è´¢å¹´è®¡ç®—æ”¯æŒ

#### æ•°æ®è¯»å–å±‚
- âœ… [excel_reader.py](src/ingestion/excel_reader.py) - Excelæ•°æ®è¯»å–
  - æ”¯æŒ22ä¸ªå·¥ä½œè¡¨è§£æ
  - è‡ªåŠ¨å­—æ®µæ˜ å°„
  - æ”¯æŒFFå­—æ®µè¯»å–

#### ä¸šåŠ¡è®¡ç®—å±‚
- âœ… [calculator.py](src/transformation/calculator.py) - ä¸šåŠ¡è®¡ç®—å™¨
  - 20ä¸ªæ ¸å¿ƒæŒ‡æ ‡è®¡ç®—
  - YoY/MoMå¢é•¿ç‡
  - æ¸ é“å‰”é™¤åŠŸèƒ½ (FFã€SC)
  - æ—¥åº¦â†’æœˆåº¦èšåˆ

- âœ… [channel_aggregator.py](src/transformation/channel_aggregator.py) - æ¸ é“æ±‡æ€»å™¨
  - TOTAL = PFS + DTC
  - DTC = WBTQ + OFS
  - Core Businessè®¡ç®—

- âœ… [core_business_calculator.py](src/transformation/core_business_calculator.py) - æ ¸å¿ƒä¸šåŠ¡è®¡ç®—å™¨
  - DTC_EXCL_FFè®¡ç®—
  - DTC_EXCL_FF_SCè®¡ç®—
  - CORE_BUSINESSè®¡ç®—

#### æ•°æ®éªŒè¯å±‚
- âœ… [validator.py](src/validation/validator.py) - æ•°æ®éªŒè¯å™¨
  - å®Œæ•´æ€§æ£€æŸ¥
  - ä¸šåŠ¡è§„åˆ™éªŒè¯
  - è´¨é‡è¯„åˆ† (0-100)

### 2. è¿è¡Œç³»ç»Ÿ

#### ä¸»å…¥å£æ–‡ä»¶
- âœ… [main.py](main.py) - å®Œæ•´çš„æ•°æ®å¤„ç†ç®¡é“
  - æ•°æ®è¯»å– â†’ èšåˆ â†’ æ±‡æ€» â†’ Core Business â†’ éªŒè¯ â†’ è¾“å‡º
  - æ”¯æŒå‘½ä»¤è¡Œå‚æ•°
  - å®Œæ•´çš„æ—¥å¿—è®°å½•

#### æµ‹è¯•ç³»ç»Ÿ
- âœ… [test_phase1.py](test_phase1.py) - Phase 1åŠŸèƒ½æµ‹è¯•
  - æ¨¡æ‹Ÿæ•°æ®ç”Ÿæˆ
  - å…¨åŠŸèƒ½æµ‹è¯•
  - æ¸ é“å‰”é™¤éªŒè¯
  - Core Businessè®¡ç®—éªŒè¯

### 3. é…ç½®ç³»ç»Ÿ

- âœ… [config.yaml](config.yaml) - ç³»ç»Ÿé…ç½®
  - æ•°æ®æºé…ç½®
  - æ¸ é“å‰”é™¤é…ç½®
  - éªŒè¯è§„åˆ™é…ç½®
  - AIé…ç½®é¢„ç•™

### 4. æ–‡æ¡£ç³»ç»Ÿ

- âœ… [README.md](README.md) - é¡¹ç›®æ€»è§ˆ
- âœ… [docs/PHASE1_USAGE_GUIDE.md](docs/PHASE1_USAGE_GUIDE.md) - ä½¿ç”¨æŒ‡å—
- âœ… [docs/CORE_BUSINESS_FEATURE.md](docs/CORE_BUSINESS_FEATURE.md) - Core BusinessåŠŸèƒ½è¯´æ˜
- âœ… [examples/core_business_usage.py](examples/core_business_usage.py) - ä½¿ç”¨ç¤ºä¾‹
- âœ… [data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv](data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv) - æ•°æ®æ ¼å¼ç¤ºä¾‹

---

## ğŸš€ å¦‚ä½•è¿è¡Œç³»ç»Ÿ

### æ­¥éª¤1: å®‰è£…ä¾èµ–

```bash
cd mbr-rpa
pip install -r requirements.txt
```

### æ­¥éª¤2: æµ‹è¯•åŠŸèƒ½ (æ¨è)

```bash
# ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
python test_phase1.py --mock
```

**é¢„æœŸè¾“å‡º**:
```
================================================================================
MBRè‡ªåŠ¨åŒ–ç³»ç»Ÿ - Phase 1 åŠŸèƒ½æµ‹è¯•
================================================================================
åˆ›å»º 31 å¤©çš„æ¨¡æ‹Ÿæ•°æ®...
âœ“ åˆ›å»ºäº† 62 æ¡æ—¥åº¦æ•°æ®

================================================================================
æµ‹è¯•1: æ•°æ®èšåˆåŠŸèƒ½
================================================================================

âœ“ DTCæœˆåº¦èšåˆ:
  GMV:             6,265,000.00
  NET:             5,638,500.00
  UV:                  160,495
  Buyers:               5,565
  CR (%):                3.47
  AOV:                3,542.78
  ATV:               3,556.90

================================================================================
æµ‹è¯•2: æ¸ é“å‰”é™¤åŠŸèƒ½
================================================================================

æ¸ é“å‰”é™¤å¯¹æ¯” (2025-12):
æ¸ é“                          NET              GMV             UV
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DTC (å®Œæ•´)              5,638,500.00     6,265,000.00        160,495
DTC excl FF             5,410,500.00     6,011,700.00        160,195
DTC excl FF&SC          4,875,500.00     5,417,100.00        159,795
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
FFè´¡çŒ®                    228,000.00      253,300.00            300
SCè´¡çŒ®                    535,000.00      594,600.00            400

================================================================================
æµ‹è¯•3: Core Businessè®¡ç®—
================================================================================

âœ“ Core Businessè®¡ç®—ç»“æœ (2025-12):
æŒ‡æ ‡                 PFS              DTC excl FF&SC    Core Business
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
NET              8,445,000.00        4,875,500.00       13,320,500.00
GMV              9,382,500.00        5,417,100.00       14,799,600.00
UV                   251,240            159,795            411,035
CR (%)                  3.18                3.83                3.42
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ¸ é“å æ¯”: PFS 63.4% | DTC excl FF&SC 36.6%

âœ“ æ‰€æœ‰æµ‹è¯•å®Œæˆ!
```

### æ­¥éª¤3: ä½¿ç”¨å®é™…æ•°æ®

å‡†å¤‡Excelæ•°æ®æ–‡ä»¶:
1. å‚è€ƒ [ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv](data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv) æ ¼å¼
2. æ”¾ç½®åœ¨ `data/input/` ç›®å½•
3. è¿è¡Œå¤„ç†:

```bash
python main.py --input data/input/MBRæ•°æ®æ¨¡æ¿.xlsx --period 2025-12
```

---

## ğŸ“Š æ•°æ®æ ¼å¼è¦æ±‚

### æœ€å°å¿…éœ€å­—æ®µ

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| Date | date | æ—¥æœŸ (YYYY-MM-DD) |
| channel | string | æ¸ é“ (PFS/DTC/TOTAL) |
| gmv | float | å•†å“äº¤æ˜“æ€»é¢ |
| net | float | å‡€é”€å”®é¢ |
| uv | int | è®¿å®¢æ•° |
| buyers | int | è´­ä¹°äººæ•° |

### æ¸ é“å‰”é™¤å­—æ®µ (å¯é€‰)

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| dtc_ff_net | float | å‘˜å·¥ç¦åˆ©å‡€é”€å”® |
| dtc_ff_gmv | float | å‘˜å·¥ç¦åˆ©GMV |
| dtc_ff_traffic | int | å‘˜å·¥ç¦åˆ©æµé‡ |
| dtc_social_net | float | ç¤¾ç¾¤æ¨å¹¿å‡€é”€å”® |
| dtc_social_gmv | float | ç¤¾ç¾¤æ¨å¹¿GMV |
| dtc_social_traffic | int | ç¤¾ç¾¤æ¨å¹¿æµé‡ |

### å®Œæ•´ç¤ºä¾‹

æŸ¥çœ‹ [data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv](data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv)

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

### 1. æ¸ é“å‰”é™¤

```python
from src.transformation.calculator import DataAggregator
from src.models.data_schema import ChannelType

aggregator = DataAggregator(daily_metrics)

# å‰”é™¤FF(å‘˜å·¥ç¦åˆ©)
dtc_excl_ff = aggregator.aggregate_monthly_with_exclusion(
    2025, 12, ChannelType.DTC,
    exclude_ff=True,
    exclude_social=False
)

# å‰”é™¤FFå’ŒSC(ç¤¾ç¾¤æ¨å¹¿)
dtc_excl_ff_sc = aggregator.aggregate_monthly_with_exclusion(
    2025, 12, ChannelType.DTC,
    exclude_ff=True,
    exclude_social=True
)
```

### 2. Core Businessè®¡ç®—

```python
from src.transformation.channel_aggregator import ChannelAggregator

core_business = ChannelAggregator.calculate_core_business(
    pfs_metric,
    dtc_excl_ff_sc_metric
)

# Core Business = PFS + DTC_EXCL_FF_SC
# åæ˜ å‰”é™¤ç‰¹æ®Šæ¸ é“åçš„æ ¸å¿ƒä¸šåŠ¡èƒ½åŠ›
```

### 3. é…ç½®é©±åŠ¨çš„å¤„ç†

ä¿®æ”¹ [config.yaml](config.yaml):

```yaml
processing:
  channel_exclusion:
    enabled: true
    dtc_exclusions:
      exclude_ff: true      # å¯ç”¨FFå‰”é™¤
      exclude_social: true  # å¯ç”¨SCå‰”é™¤
```

ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æ‰€æœ‰æ´¾ç”Ÿæ¸ é“æŒ‡æ ‡!

---

## ğŸ“ˆ ç³»ç»Ÿèƒ½åŠ›

### æ”¯æŒçš„æ¸ é“ç±»å‹

- TOTAL (å…¨æ¸ é“)
- PFS (å¹³å°æ¸ é“: å¤©çŒ«/äº¬ä¸œ)
- DTC (ç›´è¥æ¸ é“)
- DTC_EXCL_FF (DTCå‰”é™¤å‘˜å·¥ç¦åˆ©)
- DTC_EXCL_FF_SC (DTCå‰”é™¤FFå’ŒSC)
- CORE_BUSINESS (æ ¸å¿ƒä¸šåŠ¡)

### æ”¯æŒçš„è®¡ç®—

- âœ… 20ä¸ªæ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡
- âœ… YoY/MoMå¢é•¿ç‡
- âœ… è´¢å¹´è®¡ç®— (4æœˆåˆ¶)
- âœ… YTDèšåˆ
- âœ… æ¸ é“å±‚çº§æ±‡æ€»
- âœ… æ¸ é“å‰”é™¤
- âœ… Core Businessè®¡ç®—
- âœ… æ•°æ®è´¨é‡è¯„åˆ†

### æ”¯æŒçš„æ•°æ®æº

- âœ… Excel (.xlsx, .xls)
- âœ… CSV
- ğŸ”„ æ•°æ®åº“ (æ¥å£å·²é¢„ç•™)

---

## ğŸ”§ ç³»ç»Ÿæ¶æ„

```
ç”¨æˆ·è¾“å…¥
    â†“
Excelæ•°æ®æ–‡ä»¶ (data/input/MBRæ•°æ®æ¨¡æ¿.xlsx)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.py - ä¸»å…¥å£                    â”‚
â”‚  - å‚æ•°è§£æ                          â”‚
â”‚  - é…ç½®åŠ è½½                          â”‚
â”‚  - æµç¨‹ç¼–æ’                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®è¯»å– (ingestion)                â”‚
â”‚  - ExcelDataReader                   â”‚
â”‚  - è§£æ22ä¸ªå·¥ä½œè¡¨                    â”‚
â”‚  - ç»Ÿä¸€æ•°æ®æ¨¡å‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®å¤„ç† (transformation)           â”‚
â”‚  - DataAggregator (èšåˆ)             â”‚
â”‚  - MetricCalculator (è®¡ç®—)           â”‚
â”‚  - ChannelAggregator (æ±‡æ€»)          â”‚
â”‚  - CoreBusinessCalculator (æ ¸å¿ƒä¸šåŠ¡) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®éªŒè¯ (validation)               â”‚
â”‚  - å®Œæ•´æ€§æ£€æŸ¥                        â”‚
â”‚  - è´¨é‡è¯„åˆ†                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
è¾“å‡ºç»“æœ
    - æ§åˆ¶å°æ—¥å¿—
    - outputs/logs/app.log
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ |
|------|------|
| [README.md](README.md) | é¡¹ç›®æ€»è§ˆ |
| [docs/PHASE1_USAGE_GUIDE.md](docs/PHASE1_USAGE_GUIDE.md) | è¯¦ç»†ä½¿ç”¨æŒ‡å— |
| [docs/CORE_BUSINESS_FEATURE.md](docs/CORE_BUSINESS_FEATURE.md) | Core BusinessåŠŸèƒ½ |
| [examples/core_business_usage.py](examples/core_business_usage.py) | ä½¿ç”¨ç¤ºä¾‹ä»£ç  |
| [data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv](data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv) | æ•°æ®æ ¼å¼ç¤ºä¾‹ |

---

## âœ… æ£€æŸ¥æ¸…å•

åœ¨ä½¿ç”¨ç³»ç»Ÿå‰ï¼Œè¯·ç¡®è®¤:

- [ ] Python 3.11+ å·²å®‰è£…
- [ ] ä¾èµ–å·²å®‰è£…: `pip install -r requirements.txt`
- [ ] æµ‹è¯•é€šè¿‡: `python test_phase1.py --mock`
- [ ] Excelæ•°æ®æ–‡ä»¶å·²å‡†å¤‡ (å‚è€ƒç¤ºä¾‹æ ¼å¼)
- [ ] config.yaml é…ç½®æ­£ç¡® (å¯é€‰)
- [ ] è¾“å‡ºç›®å½•å­˜åœ¨: `outputs/logs/`

---

## ğŸ“ ä¸‹ä¸€æ­¥

### ç«‹å³å¯ç”¨
1. âœ… ä½¿ç”¨ `python test_phase1.py --mock` æµ‹è¯•ç³»ç»Ÿ
2. âœ… å‡†å¤‡Excelæ•°æ® (å‚è€ƒç¤ºä¾‹æ ¼å¼)
3. âœ… è¿è¡Œ `python main.py --input your_data.xlsx`

### Phase 2 è®¡åˆ’
- AIæ´å¯Ÿç”Ÿæˆ
- Claude APIé›†æˆ
- è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ

### Phase 3 è®¡åˆ’
- PowerPointè‡ªåŠ¨ç”Ÿæˆ
- æ¨¡æ¿ç³»ç»Ÿ
- å“ç‰Œä¸€è‡´æ€§

---

## ğŸ’¡ å¸¸è§é—®é¢˜

**Q: æˆ‘æ²¡æœ‰å®é™…æ•°æ®æ€ä¹ˆåŠ?**
A: è¿è¡Œ `python test_phase1.py --mock` ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

**Q: Excelæ•°æ®æ ¼å¼ä¸å¯¹æ€ä¹ˆåŠ?**
A: å‚è€ƒ [data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv](data/input/ç¤ºä¾‹æ•°æ®_ç›®æ ‡è¡¨.csv) çš„æ ¼å¼

**Q: å¦‚ä½•å¯ç”¨æ¸ é“å‰”é™¤åŠŸèƒ½?**
A: ä¿®æ”¹ [config.yaml](config.yaml) ä¸­çš„ `channel_exclusion` é…ç½®

**Q: ç³»ç»Ÿæ”¯æŒå“ªäº›æ¸ é“?**
A: TOTAL, PFS, DTC, DTC_EXCL_FF, DTC_EXCL_FF_SC, CORE_BUSINESS

**Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†æ—¥å¿—?**
A: æŸ¥çœ‹ `outputs/logs/app.log` æ–‡ä»¶

---

**ç³»ç»ŸçŠ¶æ€**: âœ… Phase 1 å®Œæˆå¹¶å¯è¿è¡Œ
**æœ€åæ›´æ–°**: 2025-01-10
