# MBR自动化系统配置文件

application:
  name: "MBR Automation System"
  version: "1.0.0"
  environment: "development"  # development, staging, production
  debug: true

# 数据源配置
data_sources:
  # 数据库配置 (推荐用于生产环境)
  database:
    enabled: false  # 设置为true启用数据库查询
    connection:
      host: "rm-uf68p191h7j2o40s34o.mysql.rds.aliyuncs.com"
      port: 3306
      database: "dunhill"
      user: "novelan"
      password: "${DB_PASSWORD}"  # 从环境变量读取
      charset: "utf8mb4"
      pool_size: 5
      max_overflow: 10
      connection_timeout: 30

  # 数据源优先级
  priority:
    - database  # 优先使用数据库
    - excel     # 数据库不可用时使用Excel

  # 工作表数据源映射
  sheets:
    # 使用数据库查询的工作表
    target_table:
      source: database
      query: "src/ingestion/database/queries/target_metrics.sql"

    monthly_summary:
      source: database
      query: "src/ingestion/database/queries/monthly_summary.sql"

    traffic_source_l1:
      source: database
      query: "src/ingestion/database/queries/traffic_l1.sql"

    traffic_source_l2:
      source: database
      query: "src/ingestion/database/queries/traffic_l2.sql"

    traffic_source_l3:
      source: database
      query: "src/ingestion/database/queries/traffic_l3.sql"

    # 通过计算生成的工作表
    campaign:
      source: calculated
      method: aggregate_by_campaign

    sales_overview:
      source: calculated
      method: calculate_overview

    dunhill_traffic_pivot:
      source: calculated
      method: create_pivot_table

    pfs_traffic:
      source: calculated
      method: aggregate_pfs_traffic

  # Excel配置 (备用数据源)
  excel:
    default_path: "data/input/"
    supported_formats: [".xlsx", ".xls"]
    max_file_size_mb: 50

  csv:
    encoding: "utf-8"
    delimiter: ","

# 数据处理配置
processing:
  date_format: "%Y-%m-%d"
  currency: "CNY"
  locale: "zh_CN"

  # 计算设置
  yoy_baseline_months: 12
  mom_baseline_months: 1

  # 聚合规则
  aggregate_by: ["month", "quarter", "channel"]
  include_ytd: true

  # 渠道剔除配置 (用于灵活的业务分析)
  channel_exclusion:
    # 是否启用DTC渠道剔除
    enabled: true

    # DTC剔除配置
    dtc_exclusions:
      # 剔除FF (员工福利) - 适用于日常销售分析
      exclude_ff: false

      # 剔除SC (Social社群推广) - 适用于核心业务分析
      exclude_social: false

      # 同时剔除FF和SC - 用于Core Business计算
      exclude_ff_and_social: false

    # 自动计算派生渠道指标
    calculate_derived_channels:
      - DTC_EXCL_FF           # DTC剔除FF
      - DTC_EXCL_FF_SC        # DTC剔除FF和SC
      - CORE_BUSINESS         # PFS + DTC_EXCL_FF_SC

# 数据验证配置
validation:
  strict_mode: false
  fail_on_warning: false

  rules:
    required_sheets:
      - "目标表"

    required_metrics:
      - gmv
      - net
      - uv
      - cr
      - aov

    data_quality:
      min_data_points: 20
      max_missing_percentage: 0.1

# AI配置
ai:
  provider: "anthropic"
  model: "claude-3-5-sonnet-20241022"
  max_tokens: 4000
  temperature: 0.3

  insight_generation:
    enabled: true
    executive_summary: true
    sales_insights: true
    traffic_insights: true
    recommendations: true

# PowerPoint配置
powerpoint:
  template_dir: "templates"
  default_brand: "dunhill"

  slide_settings:
    width: 12192000  # 标准16:9
    height: 6858000

  formatting:
    decimal_places: 2
    thousands_separator: true
    percentage_format: "0.0%"

  quality:
    min_slide_count: 18
    require_tables: true
    require_charts: false  # 由于python-pptx限制,暂时不强制要求

# API配置 (如果使用Web界面)
api:
  host: "0.0.0.0"
  port: 8000
  workers: 4

  cors:
    enabled: true
    origins: ["*"]

  rate_limiting:
    enabled: true
    requests_per_minute: 60

# 日志配置
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

  handlers:
    console:
      enabled: true
    file:
      enabled: true
      path: "outputs/logs/app.log"
      max_bytes: 10485760  # 10MB
      backup_count: 5

# 路径配置
paths:
  input: "data/input/"
  output: "outputs/reports/"
  templates: "templates/"
  cache: "outputs/cache/"
  logs: "outputs/logs/"
